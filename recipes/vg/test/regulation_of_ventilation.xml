<?xml version="1.0" encoding="ISO-8859-1"?>
<simulation name="Virtual Greenhouse">

    <integrator name="steps" type="UniSim::Steps">
		<parameter name="maxSteps" value="5760"/>
	</integrator>

	<model name="calendar" type="UniSim::Calendar">
		<parameter name="latitude" value="55"/>
		<parameter name="timeStep" value="5"/>
		<parameter name="timeUnit" value="m"/>
	</model>

	<model name="greenhouse">
		<model name="construction" type="vg::GreenhouseConstruction">
			<parameter name="glassType"  value="Single"/>
			<parameter name="lampType"  value="HPSL"/>
		</model>
	</model>

	<model name="rh" type="UniSim::Range">
		<parameter name="min" value="30"/>
		<parameter name="max" value="100"/>
	</model>

	<model name="indoorsTemperature" type="UniSim::Range">
		<parameter name="min" value="20"/>
		<parameter name="max" value="35"/>
	</model>

	
	<model name="regulation">

		<model name="ventilation1" type="vg::VentilationController">
			<parameter name="indoorsTemperature" value="35"/>
			<parameter name="outdoorsTemperature" value="20"/>
			<parameter name="maxTemperature" value="25"/>
			<parameter name="windSpeed" value="5"/>

			<model name="maximum" type="vg::VentilationMax">
				<parameter name="radiation" value="30"/>
			</model>
			
			<model name="byHumidity" type="vg::ProportionalControl">
				<parameter name="actualValue" ref="rh[value]"/>
				<parameter name="targetValue" value="70"/>
				<parameter name="direction" value="floor"/>
				<parameter name="gapMultiplier" value="2"/>
				<parameter name="pBand" value="0.1"/>
				<parameter name="maxSignal" ref="../maximum[signal]"/>
			</model>

			<model name="byTemperature" type="vg::ProportionalControl">
				<parameter name="actualValue" ref="..[indoorsTemperature]"/>
				<parameter name="targetValue" ref="..[maxTemperature]"/>
				<parameter name="direction" value="floor"/>
				<parameter name="pBand" value="5"/>
				<parameter name="maxSignal" ref="../maximum[signal]"/>
			</model>

			<model name="byTemperatureDiff" type="vg::VentilationByTemperatureDiff">
				<parameter name="indoorsTemperature" ref="..[indoorsTemperature]"/>
				<parameter name="outdoorsTemperature" ref="..[outdoorsTemperature]"/>
			</model>

			<model name="leeSideControl" type="vg::ControlElement">
				<parameter name="signal" ref="..[leeSideSignal]"/>
				<parameter name="rate" value="0.01"/>
				<parameter name="initState" value="0"/>
			</model>
			<model name="windSideControl" type="vg::ControlElement">
				<parameter name="signal" ref="..[windSideSignal]"/>
				<parameter name="rate" ref="../leeSideControl[rate]"/>
				<parameter name="initState" value="0"/>
			</model>
		</model>

		<model name="ventilation2" type="vg::VentilationController">
			<parameter name="indoorsTemperature" ref="indoorsTemperature[value]"/>
			<parameter name="outdoorsTemperature" value="5"/>
			<parameter name="maxTemperature" value="25"/>
			<parameter name="windSpeed" value="5"/>

			<model name="maximum" type="vg::VentilationMax">
				<parameter name="radiation" value="30"/>
			</model>
			
			<model name="byHumidity" type="vg::ProportionalControl">
				<parameter name="actualValue" value="70"/>
				<parameter name="targetValue" value="70"/>
				<parameter name="direction" value="floor"/>
				<parameter name="gapMultiplier" value="2"/>
				<parameter name="pBand" value="0.1"/>
				<parameter name="maxSignal" ref="../maximum[signal]"/>
			</model>

			<model name="byTemperature" type="vg::ProportionalControl">
				<parameter name="actualValue" ref="..[indoorsTemperature]"/>
				<parameter name="targetValue" ref="..[maxTemperature]"/>
				<parameter name="direction" value="floor"/>
				<parameter name="pBand" value="0.05"/>
				<parameter name="maxSignal" ref="../maximum[signal]"/>
			</model>

			<model name="byTemperatureDiff" type="vg::VentilationByTemperatureDiff">
				<parameter name="indoorsTemperature" ref="..[indoorsTemperature]"/>
				<parameter name="outdoorsTemperature" ref="..[outdoorsTemperature]"/>
			</model>

			<model name="leeSideControl" type="vg::ControlElement">
				<parameter name="signal" ref="..[leeSideSignal]"/>
				<parameter name="rate" value="0.01"/>
				<parameter name="initState" value="0"/>
			</model>
			<model name="windSideControl" type="vg::ControlElement">
				<parameter name="signal" ref="..[windSideSignal]"/>
				<parameter name="rate" ref="../leeSideControl[rate]"/>
				<parameter name="initState" value="0"/>
			</model>
		</model>

	</model>

	<output type="plot">
		<parameter name="title" value = "Lee-side ventilation signal"/>
		<trace label="RH (%)" ref="rh[value]"/>
		<trace label="byTemperature" ref="ventilation1/byTemperature[signal]"/>
		<trace label="byTemperatureDiff" ref="ventilation1/byTemperatureDiff[signal]"/>
		<trace label="byHumidity" ref="ventilation1/byHumidity[signal]"/>
		<trace label="Ventilation" ref="ventilation1[signal]"/>
	</output>

	<output type="plot">
		<parameter name="title" value = "Lee-side ventilation signal"/>
		<trace label="Indoors temperature (oC)" ref="indoorsTemperature[value]"/>
		<trace label="byTemperature" ref="ventilation2/byTemperature[signal]"/>
		<trace label="byTemperatureDiff" ref="ventilation2/byTemperatureDiff[signal]"/>
		<trace label="byHumidity" ref="ventilation2/byHumidity[signal]"/>
		<trace label="Ventilation" ref="ventilation2[signal]"/>
	</output>

	</simulation>