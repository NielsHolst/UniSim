/* Copyright (C) 2009-2010 by Niels Holst [niels.holst@agrsci.dk] and co-authors.
** Copyrights reserved.
** Released under the terms of the GNU General Public License version 3.0 or later.
** See www.gnu.org/copyleft/gpl.html.
*/
#ifndef UniSim_XML_EXPANDER_H
#define UniSim_XML_EXPANDER_H

#include <QStack>
#include <QString>

class QFile;
class QXmlStreamWriter;

namespace UniSim {

//! \addtogroup UniSim
//@{
//! The %XmlExpander class expands a UniSim file with all the files it refers to	
/*!
	The class is used by SimulationMaker to create Simulation objects from UniSim files.
*/
class XmlExpander
{
public: 
	//! Constructor
	/*!
		\param xmlFilePath path to original UniSim file
		\param appendedName string appended to file name in xmlFilePath to identify the expanded file
	*/
	XmlExpander(QString xmlFilePath, QString appendedName);
	
	//! Expands UniSim file with all the files it refers to	
	/*!
		Temporary files have "_nn" appended to the original file name. The final expanded file has
		appendedName appended to its file name. Uses XmlQueryToWriter to resolve the references to other
		files.
	*/
	void expand(); 
	
	//! Returns the file name of file generated by expand()
	/*!
		\return Name of generated file.
	*/
	QString newFileName() const;
	
private:
	bool expand(QFile *fromXml, QFile *toXml);
	QString appendedFileName(QString append) const;
	QString stackedPath () const;
	void writeQuery(QString queryString, QXmlStreamWriter *writer);

	QString _xmlFile, _appendedName;
	QStack<QString> _path;

};
//@}
} //namespace

#endif

