<?xml version="1.0" encoding="ISO-8859-1"?>
<simulation name="simulation" version="1.0">
	<integrator type="TimeStepLimited">
		<parameter name="maxSteps" value="365"/> <!-- all years = 20440 -->
		<sequence>
			<model name="calendar"/>
			<model name="weather"/>
			<model name="pollen"/>
			<model name="insect"/>
		</sequence>
	</integrator>

	<model name="calendar" type="Calendar"/>

	<model name="weather" type="SupplyDemand::Weather">
		<model name="records" type="UniSim::Records">
			<parameter name="fileName" value="denmark-odum-1953-2009.txt"/>
		</model>
	</model>

	<model name="pollen" type="EcoTox::Pollen">
		<parameter name="halfLife" value="30"/>
		<parameter name="distance" value="1"/>
		<parameter name="dateMax" value="31/7/2011"/>
		<parameter name="Pmax" value="120"/>
	</model>
	
	<model name="insect" type="UniSim::Insect" instances="2">
		<parameter name="sexRatio" value="0.5"/>
		<parameter name="eggProduction" value="400"/>

		<model name="lifeCycle">
			<model name="egg" type="UniSim::Stage">
				<model name="time" type="UniSim::DayDegrees">
					<parameter name="T0" value="8.3" ref="Bryant et al. 2002"/>
					<parameter name="Topt" value="32.3" ref="Bryant et al. 2000"/>
					<parameter name="Tmax" value="37"/>
				</model>
				<parameter name="duration" value="70"/>
				<parameter name="k" value="30"/>
				<parameter name="growthRate" value="0.21544"/>
				<parameter name="initialInflow" value="1"/>
			</model>

			<model name="larva" type="UniSim::Stage">
				<model name="time" type="UniSim::DayDegrees">
					<parameter name="T0" value="8.3" ref="Bryant et al. 2002"/>
					<parameter name="Topt" value="32.3" ref="Bryant et al. 2000"/>
					<parameter name="Tmax" value="37"/>
				</model>
				<parameter name="duration" value="315.2" ref="Bryant et al. 2002"/>
				<parameter name="k" value="30"/>
				<parameter name="growthRate" value="0.21544"/>
			</model>

			<model name="pupa" type="UniSim::Stage">
				<model name="time" type="UniSim::DayDegrees">
					<parameter name="T0" value="10.9" ref="Bryant et al. 2002"/>
					<parameter name="Topt" value="32.3" ref="Bryant et al. 2000"/>
					<parameter name="Tmax" value="37"/>
				</model>
				<parameter name="duration" value="110" ref="Bryant et al. 2002"/>
				<parameter name="k" value="30"/>
				<parameter name="growthRate" value="0.21544"/>
			</model>

			<model name="adult" type="UniSim::Stage">
				<model name="time" type="UniSim::Days"/>
				<parameter name="duration" value="60"/>
				<parameter name="k" value="30"/>
			</model>
		</model> <!-- lifeCycle -->
		
		<model name="hibernatingAdult" type="UniSim::Stage">
			<model name="time" type="UniSim::Days">
				<model name="trigger" type="UniSim::TriggerByDate">
					<parameter name="fromDate" value="25/4/1900"/>
					<parameter name="toDate" value="30/5/2200"/>
					<parameter name="frequency" value="yearly"/>
					<parameter name="triggerAtReset" value="No"/>
				</model>
			</model>
			<parameter name="duration" value="7"/>
			<parameter name="k" value="30"/>
			<parameter name="growthRate" value="0.5"/>
			<parameter name="initialInflow" value="1"/>
		</model>
		
		<model name ="eggLayingPhase" type="UniSim::Stage" >
			<model name="time" type="UniSim::Days"/>
			<parameter name="duration" value="7"/>
			<parameter name="k" value="30"/>
		</model>
	</model> <!-- insect -->

	<!-- 
	*** Plots  ***
	-->

	<output type="plot">
		<parameter name="title" value="Environment"/>
		<variable label="Day" axis="x" value="calendar[totalTime]"/>
		<variable label="Tavg" axis="y" value="weather[Tavg]"/>
		<variable label="Tmin" axis="y" value="weather/records[Tmin]"/>
		<variable label="Tmax" axis="y" value="weather/records[Tmax]"/>
	</output>

	<output type="plot" name="lifeStagesPlot">
		<parameter name="title" value ="Life stage numbers"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Egg" value="egg[value]"/>
		<variable axis="y" label="Larva" value="larva[value]"/>
		<variable axis="y" label="Pupa" value="pupa[value]"/>
		<variable axis="y" label="AdRep" value="adult[value]"/>
		<variable axis="y" label="AdHib" value="hibernatingAdult[value]"/>
	</output>

	<output type="plot" select="../output[@name='lifeStagesPlot']">
		<parameter name="title" value ="Life stage numbers (log)"/>
		<parameter name="logy" value ="yes"/>
		<parameter name="ymin" value ="-2"/>
	</output>

	<output type="plot">
		<parameter name="title" value ="Pollen deposition"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Deposition rate" value="pollen[pollenDepositionRate]"/>
	</output>

	<output type="plot">
		<parameter name="title" value ="Pollen density (per cm2)"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Deposition rate" value="pollen[pollenDepositionRate]"/>
		<variable axis="y" label="Deposition total" value="pollen[pollenDepositionTotal]"/>
		<variable axis="y" label="Pollen" value="pollen[pollen]"/>
		<variable axis="y" label="Toxin (pg)" value="pollen[toxin]"/>
	</output>

	<output type="plot">
		<parameter name="title" value ="Bt exposure"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Toxin (pg/cm2)" value="pollen[toxin]"/>
		<variable axis="y" label="Larva" value="larva[value]"/>
	</output>
	
	<!-- 
	*** Tables  ***
	-->
	<output type="table">
		<parameter name="filename" value ="odum.txt"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="x" label="Julian" value="calendar[dayOfYear]"/>
		<variable axis="x" label="Day" value="calendar[dayLength]"/>
		<variable axis="y" label="Tavg" value="weather[Tavg]"/>
		<variable axis="y" label="Deposition" value="pollen[pollenDepositionRate]"/>
		<variable axis="y" label="Pollen" value="pollen[pollen]"/>
	</output>

</simulation>
