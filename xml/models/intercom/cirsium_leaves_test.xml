<?xml version="1.0" encoding="ISO-8859-1"?>
<simulation version="1.0">

     <integrator type="Steps">
         <parameter name="maxSteps" value="30"/>
     </integrator>
	
	<model name="calendar" type="unisim::Calendar">
		<parameter name="latitude" value="55"/>
		<parameter name="initialDate" value="1/4/2005"/>
	</model>
	
	<model name="weather" type="intercom::Weather">
		<model name="records" type="UniSim::Fixed">
			<parameter name="pullVariables" value = "((Tmin 20)(Tmax 20)(irradiationMJ 20))"/>
		</model>
	</model>

	<model name="field" type="intercom::Community">
		<parameter name="earlyGrowthThreshold" value="1"/>
		<parameter name="testMode" value="yes"/>
				
		<model name="cirsium" type="intercom::Plant">
			<parameter name="density" value="10"/>
			
			<model name="phenology" type="intercom::Phenology">
				<model name="vegetative" type="UniSim::Stage">
					<parameter name="duration" value="600"/>
				</model>
				<model name="flowering" type="UniSim::Stage">
					<parameter name="duration" value="200"/>
				</model>
				<model name="senescent" type="UniSim::Stage">
					<model name="time" type="UniSim::Days"/>
					<parameter name="duration" value="60"/>
				</model>
			</model>

			<model name="time" type="UniSim::PhotoThermalTime">
				<parameter name="T0" value="4"/>
			</model>
			
			<model name="height" type="intercom::Height">
				<parameter name="h0" value="0.01"/>
				<parameter name="hmax" value="1"/>
				<parameter name="tm" value="500"/>
			</model>
			
			<model name="earlyGrowth" type="UniSim::exponential"> 
				<parameter name="initialValue" value="1" comment="cm2 per plant"/>
				<parameter name="growthRate" value="0.03"/>
			</model>

			<!-- Leaves -->
			<model name="leaves" type="intercom::Organ">
			
				<model name="area" type="intercom::Area">
					<parameter name="kDiffuse" value="0.7"/>

					<model name="area" type="UniSim::Stage">
						<parameter name="duration" value="300"/>
					</model>

					<model name="specificLeafArea" type="intercom::SpecificLeafArea">
						<parameter name="initial" value="240"/>
						<parameter name="slope" value="-0.075"/>
					</model>

					<model name="density" type="intercom::AreaDensitySymmetric"/>
					<model name="amax" type="intercom::AssimilationMaxGivenTemp"/>
					<model name="lightUseEfficiency" type="intercom::LightUseEfficiencyGivenTemp"/>
				</model>

				<model name="mass" type="intercom::Mass">
					<model name="mass" type="UniSim::Stage">
						<parameter name="duration" value="300"/>
					</model>
					<model name="partition" type="intercom::PartitioningFixed">
						<parameter name="value" value="0.5"/>
					</model>
				</model>
			</model>

			<!-- Stem -->
			<model name="stem" type="intercom::Organ">

				<model name="area" type="intercom::Area">
					<parameter name="kDiffuse" value="0.3"/>

					<model name="area" type="UniSim::Stage">
						<parameter name="duration" value="600"/>
					</model>

					<model name="specificLeafArea" type="intercom::SpecificLeafArea">
						<parameter name="initial" value="20"/>
						<parameter name="slope" value="0"/>
					</model>

					<model name="density" type="intercom::AreaDensityTapering"/>
					<model name="amax" type="intercom::AssimilationMaxGivenTemp"/>
					<model name="lightUseEfficiency" type="intercom::LightUseEfficiencyGivenTemp"/>
				</model>

				<model name="mass" type="intercom::Mass">
					<model name="mass" type="UniSim::Stage">
						<parameter name="duration" value="600"/>
					</model>
					<model name="partition" type="intercom::PartitioningFixed">
						<parameter name="value" value="0.2"/>
					</model>
				</model>
			</model>

			<!-- Flowers -->
			<model name="flowers" type="intercom::Organ">

				<model name="area" type="intercom::Area">
					<parameter name="kDiffuse" value="0.4"/>

					<model name="area" type="UniSim::Stage">
						<parameter name="duration" value="200"/>
					</model>

					<model name="specificLeafArea" type="intercom::SpecificLeafArea">
						<parameter name="initial" value="20"/>
						<parameter name="slope" value="0"/>
					</model>

					<model name="density" type="intercom::AreaDensityTopheavy"/>
					<model name="amax" type="intercom::AssimilationMaxGivenTemp"/>
					<model name="lightUseEfficiency" type="intercom::LightUseEfficiencyGivenTemp"/>
				</model>

				<model name="mass" type="intercom::Mass">
					<model name="mass" type="UniSim::Stage">
						<parameter name="duration" value="200"/>
					</model>
					<model name="partition" type="intercom::PartitioningFixed">
						<parameter name="value" value="0.05"/>
					</model>
				</model>
			</model>
			
			<!-- Root -->
			<model name="root" type="intercom::Organ">
				<model name="mass" type="intercom::Mass">
					<model name="mass" type="UniSim::Stage">
						<parameter name="duration" value="600"/>
					</model>
					<model name="partition" type="intercom::PartitioningFixed">
						<parameter name="value" value="0.25"/>
					</model>
				</model>
			</model>
			
			<!-- Observations
			<dataset name="obs_height">
				<parameter name="filename" value="cirar_height_2005.txt"/>
				<parameter name="headerLines" value ="1"/>
				<parameter name="columns" value="((day_in_year 2) (height 3))"/>
			</dataset>
			-->
		</model>
	</model>

    <!-- Plots of environment -->

	<output type="plot">
		<parameter name="title" value="Day length (hours)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="hours" axis="y" value="calendar[dayLength]"/>
	</output>
    
	<output type="plot">
		<parameter name="title" value="Time scales"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Time" axis="y" value="time[total]"/>
	</output>

	<output type="plot">
		<parameter name="title" value="Temperature (oC) and irradiation (MJ/m2/d)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Tday" axis="y" value="weather[Tday]"/>
		<variable label="Itotal" axis="y" value="weather/records[irradiationMJ]"/>
    </output>

    <!-- Plots of plant -->
    <output type="plot">
		<parameter name="title" value="Plant growth stage"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="GS" axis="y" value="cirsium/phenology/*[number]"/>
    </output>

    <output type="plot">
		<parameter name="title" value="Plant density (plants/m2)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="density" axis="y" value="cirsium[density]"/>
    </output>

    <output type="plot">
		<parameter name="title" value="Plant height (m)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="height" axis="y" value="cirsium/height[height]"/>
		<!--
		<data axis="x" label="Day" value="obs_height[day_in_year]"/>
		<data axis="y" label="Obs" value="obs_height[height]"/>
		-->
    </output>

    <output type="plot">
		<parameter name="title" value="Plant LAI"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="LAI" axis="y" value="cirsium[lai]"/>
		<variable label="early" axis="y" value="field[isInEarlyGrowth]"/>
    </output>

    <output type="plot">
		<parameter name="title" value="Plant energy budget (kg/ha/day)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="CO2 assim." axis="y" value="cirsium[CO2assimilation]"/>
		<variable label="gross prod." axis="y" value="cirsium[grossProduction]"/>
		<variable label="maint. resp." axis="y" value="cirsium[maintenanceResp]"/>
		<variable label="avail. prod." axis="y" value="cirsium[availableProduction]"/>
    </output>

    <output type="plot">
		<parameter name="title" value="Plant allocation (g/plant/day)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Leaves" axis="y" value="cirsium/leaves[allocatedPerPlant]"/>
		<variable label="Stem" axis="y" value="cirsium/stem[allocatedPerPlant]"/>
		<variable label="Flowers" axis="y" value="cirsium/flowers[allocatedPerPlant]"/>
		<variable label="Root" axis="y" value="cirsium/root[allocatedPerPlant]"/>
		<variable label="Total" axis="y" value="cirsium[allocatedPerPlant]"/>
    </output>

    <!-- Plots of organs -->
	
	<output type="plot">
		<parameter name="title" value="Amax (kg CO2/ha leaf/hour)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="amax[value]"/>
	</output>

	<output type="plot">
		<parameter name="title" value="Light use efficiency (kg CO2/ha leaf/hour)/(W/m2 leaf)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="lightUseEfficiency[value]"/>
	</output>

    <output type="plot">
		<parameter name="title" value="Mass of organs (g/plant)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="mass/mass[number]"/>
    </output>
	
	<output type="plot">
		<parameter name="title" value="Area of organs (cm2/plant)"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="area/area[number]"/>
    </output>

	<output type="plot">
		<parameter name="title" value="Ideal organ partition"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="partition[value]"/>
    </output>

	<output type="plot">
		<parameter name="title" value="Actual organ partition"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="mass[currentPartition]"/>
    </output>

	<output type="plot">
		<parameter name="title" value="Relative allocation rates"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Organ" axis="y" value="cirsium/*[propAllocatedPerPlant]"/>
    </output>

	<!-- Outputs on file -->

	<output type="table">
		<parameter name="filename" value="intercom.prn"/>
		<variable label="Day" axis="x" value="calendar[dayOfYear]"/>
		<variable label="Plant_LAI" axis="y" value="cirsium[lai]"/>
		<variable label="early" axis="y" value="field[isInEarlyGrowth]"/>

		<variable label="Mleaves" axis="y" value="leaves/mass/mass[number]"/>
		<variable label="Mstem" axis="y" value="stem/mass/mass[number]"/>
		<variable label="Mflowers" axis="y" value="flowers/mass/mass[number]"/>

		<variable label="Aleaves" axis="y" value="leaves/area/area[number]"/>
		<variable label="Astem" axis="y" value="stem/area/area[number]"/>
		<variable label="Aflowers" axis="y" value="flowers/area/area[number]"/>

		<variable label="Allocleaves" axis="y" value="leaves/area[allocation]"/>
		<variable label="Allocstem" axis="y" value="stem/area[allocation]"/>
		<variable label="Allocflowers" axis="y" value="flowers/area[allocation]"/>

		<variable label="INleaves" axis="y" value="leaves/area/area[inflowTotal]"/>
		<variable label="INstem" axis="y" value="stem/area/area[inflowTotal]"/>
		<variable label="INflowers" axis="y" value="flowers/area/area[inflowTotal]"/>

		<variable label="DTleaves" axis="y" value="leaves/area/area[timestep]"/>
		<variable label="DTstem" axis="y" value="stem/area/area[timestep]"/>
		<variable label="DTflowers" axis="y" value="flowers/area/area[timestep]"/>

		</output>

</simulation>
