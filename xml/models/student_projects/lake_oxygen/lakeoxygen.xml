<?xml version="1.0" encoding="ISO-8859-1"?>
<simulation version="1.0">
	<integrator type="TimeStepLimited">
		<parameter name="maxSteps" value="732"/>
		<sequence>
			<model name="random"/>
			<model name="calendar"/>
			<model name="weather"/>
			<model name="netproduction"/>
			<model name="OxygenConcentration"/>
		</sequence>
		<model name="RunIterator" type="UniSim::RunIteratorFixed">
			<parameter name="numIterations" value="30"/>
		</model>
	</integrator>
	
	<model name="random"> <!-- In the model we have implemented a stochastic module to generate random numbers in a range for the Reaeration coefficient-->
		<model name="Kl" type="UniSim::RandomUniform">
			<parameter name="minValue" value="0.2"/> <!--Lowest value of the interval for stochastic number generating -->
			<parameter name="maxValue" value="2"/> <!--Highest value of the interval for stochastic number generating -->
		</model>
	</model>
	
	<model name="calendar" type="UniSim::Calendar">
		<parameter name="latitude" value="55.3" comment="Gundsømagle Sø"/> 
	</model>

	<model name="weather" type="UniSim::Records">
		<parameter name="filename" value="LakedataOBS2004-2005.txt"/>
		<parameter name="imposeInitialDateAndTime" value="yes"/>
	</model>
	
	<model name="netproduction" type="lakeoxygen::Netproduction">
		<parameter name="Unit" value="0"/> <!--Converts between Oxygen and Carbon as output if 0 then Oxygen if 1 then carbon-->
		<parameter name="K" variable="random/Kl[value]" old_value="0.2"/>
		
	</model>
	
		
	<model name="OxygenConcentration" type="lakeoxygen::OxygenConcentration">
	</model>

	<!--Generating plots based on calculations -->
	<output type="plot">
		<parameter name="title" value ="Lake environment"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Wind [m/s]" value="weather[Wind]"/>
		<variable axis="y" label="Daylength" value="Calendar[dayLength]"/>
		<variable axis="y" label="DLI" value="weather[DLI]"/>
	</output>
	
	<output type="plot">
		<parameter name="title" value ="Net community production [unit/m2/day]"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="NCP (Kl estimated from wind)" value="Netproduction[NetProdwind]" />
		<variable axis="y" label="NCP (KL stochastic)" value="Netproduction[NetProd]"/>
	</output>

	
	<output type="plot" name="plot">
		<parameter name="title" value ="Accumulated Net Community Production"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Sum (wind)" value="Netproduction[SumWind]"/>
		<variable axis="y" label="Sum (stochastic)" value="Netproduction[SumStochastic]"/>
	</output>
	
	<output type="plot">
		<parameter name="title" value ="Averaged estimated reaeration coefficent (from wind speed)"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Kl" value="Netproduction[Kwind]" summary = "average" />
	</output>
	
	<output type="plot">
		<parameter name="title" value ="Observations"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="DO[mg/l]" value="weather[obsDO]"/>
		<variable axis="y" label="Water temp[oC]" value="weather[tempW]"/>
	</output>
	
	
	<output type="plot" summary ="yes">
		<parameter name="title" value ="Parameter"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Kl" value="random/Kl[value]"/>
	</output>

	<!--Generating table output to text file-->
	<output type="Table">
		<parameter name="Filename" value ="Prediction.txt"/>
		<variable axis="x" label="Day" value="calendar[totalTime]"/>
		<variable axis="y" label="Daylength [hr]" value="Calendar[dayLength]"/>
		<variable axis="y" label="DO[mg/l]" value="weather[oxygen]"/>
		<variable axis="y" label="Water temp[oC]" value="weather[tempW]"/>
		<variable axis="y" label="DO observed saturation percentage" value="Netproduction[DOObsSatPct]"/>
		<variable axis="y" label="DLI" value="weather[DLI]"/>
		<variable axis="y" label="Netto Production (Stochastic)" value="Netproduction[NetProd]"/>
		<variable axis="y" label="Netto Production (Kl_wind)" value="Netproduction[Net_ProdWind]"/>
		<variable axis="y" label="Random Kl value" value="random/Kl[value]"/>
		<variable axis="y" label="Kl estimated from wind" value="Netproduction[Kwind]"/>
	</output>
</simulation>
